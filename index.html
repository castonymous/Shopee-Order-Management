<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order Board - Liquid Glass</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- XLSX (SheetJS) untuk baca Excel di browser) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    /* ... (SEMUA CSS SAMA persis seperti versi sebelumnya) ... */
  </style>
</head>
<body>
  <!-- ... (SEMUA HTML BODY SAMA persis seperti versi sebelumnya) ... -->

  <script>
    const dropZone = document.getElementById("drop-zone");
    const fileInput = document.getElementById("file-input");
    const browseBtn = document.getElementById("browse-btn");
    const tableContainer = document.getElementById("table-container");
    const paletteDots = document.querySelectorAll(".color-dot");
    let currentColor = "red";
    let selectedRow = null;

    // ---- Palette logic ----
    paletteDots.forEach(dot => {
      dot.addEventListener("click", () => {
        paletteDots.forEach(d => d.classList.remove("active"));
        dot.classList.add("active");
        currentColor = dot.dataset.color;

        if (selectedRow) {
          applyColorToRow(selectedRow, currentColor);
        }
      });
    });

    function applyColorToRow(row, color) {
      const tag = row.querySelector(".color-tag");
      if (!tag) return;
      tag.className = "color-tag " + color;
    }

    // ---- Drag & Drop ----
    dropZone.addEventListener("click", () => fileInput.click());
    browseBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      fileInput.click();
    });

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      handleFile(file);
      fileInput.value = "";
    });

    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("dragover");
    });

    dropZone.addEventListener("dragleave", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
    });

    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      const file = e.dataTransfer.files[0];
      handleFile(file);
    });

    // ---- Handle Excel file ----
    function handleFile(file) {
      if (!file) return;

      if (typeof XLSX === "undefined") {
        alert("Library XLSX belum ke-load. Cek koneksi internet / tag <script> untuk XLSX.");
        console.error("XLSX is undefined. Script library gagal dimuat.");
        return;
      }

      if (!/\.xlsx?$/.test(file.name.toLowerCase())) {
        alert("Tolong pilih file Excel (.xlsx / .xls)");
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const json = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

        if (!json || !json.length) {
          alert("Sheet pertama kosong atau tidak terbaca.");
          return;
        }

        buildTable(json);
      };
      reader.readAsArrayBuffer(file);
    }

    // ---- Build table from JSON ----
    function buildTable(rows) {
      selectedRow = null;
      tableContainer.innerHTML = "";

      const columns = Object.keys(rows[0]);

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");

      const thCheck = document.createElement("th");
      thCheck.textContent = "";
      headerRow.appendChild(thCheck);

      const thColor = document.createElement("th");
      thColor.textContent = "Status";
      headerRow.appendChild(thColor);

      columns.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");

      rows.forEach((rowData, index) => {
        const tr = document.createElement("tr");
        tr.dataset.index = index;

        const tdCheck = document.createElement("td");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.className = "row-checkbox";
        cb.addEventListener("change", () => {
          if (cb.checked) {
            tr.classList.add("row-done");
          } else {
            tr.classList.remove("row-done");
          }
        });
        tdCheck.appendChild(cb);
        tr.appendChild(tdCheck);

        const tdColor = document.createElement("td");
        const tag = document.createElement("div");
        tag.className = "color-tag";
        tdColor.appendChild(tag);
        tr.appendChild(tdColor);

        const columns = Object.keys(rowData);
        columns.forEach(col => {
          const td = document.createElement("td");
          const span = document.createElement("span");
          span.className = "cell-text";
          span.textContent = rowData[col];
          td.appendChild(span);
          tr.appendChild(td);
        });

        tr.addEventListener("click", (e) => {
          if (e.target.tagName === "INPUT") return;

          if (selectedRow && selectedRow !== tr) {
            selectedRow.classList.remove("selected");
          }
          selectedRow = tr;
          tr.classList.toggle("selected");

          if (tr.classList.contains("selected")) {
            applyColorToRow(tr, currentColor);
          }
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      tableContainer.appendChild(table);
    }
  </script>
</body>
</html>
